#!/usr/bin/expect -f
#
# This script uses expect to verify that all plugins are installed correctly
#
set timeout 10

# Start neo-cli
spawn dotnet out/neo-cli.dll

# Expect the main input prompt
expect {
    "neo> " { }
    "error" { exit 2 }
    timeout { exit 1 }
}

#
# Test 'plugins' command and verify all 12 plugins are installed
#
send "plugins\n"

# Count [Installed] occurrences - we need 12
set count 0
set expected_count 12

# Match [Installed] pattern multiple times until we reach the prompt
expect {
    -re "\\\[Installed\\\]" {
        incr count
        exp_continue
    }
    "neo> " {
        if {$count != $expected_count} {
            puts "Error: Expected $expected_count plugins installed, but found $count"
            exit 1
        }
    }
    "error" { exit 2 }
    timeout { exit 1 }
}

exit 0

